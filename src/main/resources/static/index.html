<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Market Trading Platform</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
     

    
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="news-styles.css">
    <link rel="stylesheet" href="responsive-mobile.css">
</head>
<body>
    <!-- Vertical Navigation -->
    <nav class="vertical-nav">
        <div class="nav-header">
            <h1> StockPro</h1>
            <p>Trading Platform</p>
        </div>

        <div class="nav-items">
            <div class="nav-item active" onclick="switchTab('trending')">
                <span class="nav-item-icon"></span>
                <span>Trending</span>
            </div>
            <div class="nav-item" onclick="switchTab('portfolio')">
                <span class="nav-item-icon"></span>
                <span>Portfolio</span>
            </div>
            <div class="nav-item" onclick="switchTab('history')">
                <span class="nav-item-icon"></span>
                <span>Trade History</span>
            </div>
<div class="nav-items">
<div class="nav-item" onclick="switchTab('news')">
    
       <span>News & Announcements</span>
   </div>
            <a href="dashboard.html" class="nav-item">
                <span class="nav-item-icon"></span>
                <span>Dashboard</span>
            </a>
        </div>

        <div class="nav-footer">
            <div class="user-info">
                <div class="user-avatar">U</div>
                <span>Trader</span>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Trending Tab -->
        <div id="trendingTab" class="tab-content active">
            <div class="content-header">
                <h1> Trending Stocks</h1>
                <p>Live market data from Indian stock exchanges</p>
            </div>

            <div class="search-container">
                <div class="search-box">
                    <input type="text" class="search-input" id="searchInput" placeholder="Search stocks by symbol or company name...">
                    <button class="search-btn" onclick="searchStocks()">Search</button>
                </div>
            </div>

            <div id="stocksContainer">
                <div class="loading">Loading trending stocks...</div>
            </div>
        </div>

        <!-- Portfolio Tab -->
        <div id="portfolioTab" class="tab-content">
            <div class="content-header">
                <h1>My Portfolio</h1>
                <p>Your stock holdings and performance</p>
            </div>

            

            <div class="portfolio-actions">
                <button class="action-btn btn-export" onclick="exportPortfolio()">
                    <span></span> Export Portfolio
                </button>
                <button class="action-btn btn-import" onclick="openImportPortfolioModal()">
                    <span></span> Import Portfolio
                </button>
            </div>

            <div id="portfolioContainer">
                <div class="loading">Loading portfolio...</div>
            </div>
        </div>

        <!-- Trade History Tab -->
        <div id="historyTab" class="tab-content">
            <div class="content-header">
                <h1> Trade History</h1>
                <p>Your complete trading activity</p>
            </div>

            <div class="search-container">
                <button class="search-btn" onclick="exportTradesToPDF()" style="margin-left: auto; display: block;">
                     Export to PDF
                </button>
            </div>

            <div id="historyContainer">
                <div class="loading">Loading trade history...</div>
            </div>
        </div>
         <!-- News & Announcements Tab -->
        <div id="newsTab" class="tab-content" style="justify-content: center; ">
            <div class="content-header">
                <h1>News & Announcements</h1>
                <p>Latest market news and updates from Indian stock markets</p>
            </div>

            <div id="newsContainer" style="justify-content: center;">
                <div class="loading">Loading latest news...</div>
            </div>
        </div>
    </div>

       
    <!-- Floating Action Buttons -->
    <div class="fab-container">
        <button class="fab fab-add hide" id="fabAdd" onclick="openAddHoldingModal()" title="Add Holding">+</button>
        <button class="fab fab-chat" onclick="toggleChat()" title="AI Advisor">ðŸ’¬</button>
    </div>

    <!-- Add Holding Modal -->
    <div id="addHoldingModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Add Stock to Portfolio</h2>
                <button class="close-btn" onclick="closeAddHoldingModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form onsubmit="event.preventDefault(); addHolding();">
                    <div class="form-group">
                        <label class="form-label">Exchange</label>
                        <div class="exchange-tabs">
                            <div class="exchange-tab active" id="nseTab" onclick="selectExchange('NSE')">NSE</div>
                            <div class="exchange-tab" id="bseTab" onclick="selectExchange('BSE')">BSE</div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="stockSelect">Select Stock</label>
                        <select id="stockSelect" class="form-select" required>
                            <option value="">Choose a stock...</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="purchasePrice">Purchase Price (â‚¹)</label>
                        <input type="number" id="purchasePrice" class="form-input" step="0.01" min="0.01" placeholder="Enter purchase price" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="quantity">Quantity</label>
                        <input type="number" id="quantity" class="form-input" min="1" placeholder="Enter quantity" required>
                    </div>

                    <div class="modal-actions">
                        <button type="button" class="btn btn-cancel" onclick="closeAddHoldingModal()">Cancel</button>
                        <button type="submit" class="btn btn-confirm" style="background: linear-gradient(135deg, #5cb85c 0%, #4cae4c 100%);">Add to Portfolio</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Remove/Sell Stock Modal -->
    <div id="removeStockModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Sell Stock from Portfolio</h2>
                <button class="close-btn" onclick="closeRemoveStockModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="confirmation-section">
                    <div class="stock-info-box">
                        <div class="stock-info-header">
                            <div class="stock-info-title" id="removeStockSymbol"></div>
                            <div class="stock-info-exchange" id="removeStockExchange"></div>
                        </div>
                        <div class="stock-info-name" id="removeStockName"></div>
                        
                        <div class="calculation-grid">
                            <div class="calc-item">
                                <div class="calc-label">Available Quantity</div>
                                <div class="calc-value" id="removeStockQuantity"></div>
                            </div>
                            <div class="calc-item">
                                <div class="calc-label">Purchase Price</div>
                                <div class="calc-value" id="removeStockPurchasePrice"></div>
                            </div>
                            <div class="calc-item">
                                <div class="calc-label">Current Price</div>
                                <div class="calc-value" id="removeStockCurrentPrice"></div>
                            </div>
                            <div class="calc-item">
                                <div class="calc-label">Total Invested</div>
                                <div class="calc-value" id="removeStockInvested"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Quantity Selector -->
                    <div class="quantity-selector">
                        <label class="form-label">Select Quantity to Sell</label>
                        <div class="quantity-input-group">
                            <button class="quantity-btn" onclick="decreaseQuantity()">âˆ’</button>
                            <input type="number" 
                                   id="sellQuantity" 
                                   class="quantity-input" 
                                   min="1" 
                                   value="1"
                                   oninput="updateSellCalculations()">
                            <button class="quantity-btn" onclick="increaseQuantity()">+</button>
                        </div>
                        
                        <input type="range" 
                               id="quantitySlider" 
                               class="quantity-range" 
                               min="1" 
                               value="1"
                               oninput="updateQuantityFromSlider()">
                        
                        <div class="quantity-presets">
                            <button class="preset-btn" onclick="setQuantityPreset(25)">25%</button>
                            <button class="preset-btn" onclick="setQuantityPreset(50)">50%</button>
                            <button class="preset-btn" onclick="setQuantityPreset(75)">75%</button>
                            <button class="preset-btn" onclick="setQuantityPreset(100)">100%</button>
                        </div>
                    </div>

                    <!-- Calculation Summary -->
                    <div class="calculation-summary">
                        <div class="summary-row">
                            <span class="summary-label">Selling Quantity:</span>
                            <span class="summary-value" id="summaryQuantity">0</span>
                        </div>
                        <div class="summary-row">
                            <span class="summary-label">Sale Price per Share:</span>
                            <span class="summary-value" id="summarySalePrice">â‚¹0.00</span>
                        </div>
                        <div class="summary-row">
                            <span class="summary-label">Total Sale Amount:</span>
                            <span class="summary-value highlight" id="summaryTotalSale">â‚¹0.00</span>
                        </div>
                        <div class="summary-row">
                            <span class="summary-label">Total Cost:</span>
                            <span class="summary-value" id="summaryTotalCost">â‚¹0.00</span>
                        </div>
                        <div class="summary-row">
                            <span class="summary-label">Profit/Loss:</span>
                            <span class="summary-value" id="summaryProfitLoss">â‚¹0.00</span>
                        </div>
                    </div>

                    <div id="warningMessage" style="display: none;" class="warning-message">
                        <span class="warning-icon"></span>
                        <span>You are selling all your shares. This stock will be removed from your portfolio.</span>
                    </div>
                </div>

                <div class="modal-actions">
                    <button class="btn btn-cancel" onclick="closeRemoveStockModal()">Cancel</button>
                    <button class="btn btn-confirm" onclick="confirmSellStock()">
                        Confirm Sale
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast">
        <span class="toast-icon" id="toastIcon"></span>
        <span class="toast-message" id="toastMessage"></span>
    </div>

    <script src="app.js"></script>
    <script src="responsive-mobile.js"></script>
    <script src="app-news-addon.js"></script>
    <!-- AI Chat Modal -->
    <div id="chatModal">
        <div class="chat-header">
            <h2>AI Portfolio Advisor</h2>
            <button class="chat-close-btn" onclick="toggleChat()">&times;</button>
        </div>
        
        <div class="chat-body">
            <div class="chat-response-container">
                <div class="chat-label">AI Response</div>
                <div id="botResponse">
                    <div class="ai-thinking">Click an option below to get started...</div>
                </div>
            </div>

            <div class="chat-response-container">
                <div class="chat-label">Choose an Action</div>
                <div id="chatOptions">
                    <!-- Options will be populated by JavaScript -->
                </div>
            </div>
        </div>

        <div class="chat-powered-by">
            Powered by <span>Google Gemini AI</span>
        </div>
    </div>

    <!-- Import Portfolio Modal -->
    <div id="importPortfolioModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title"> Import Portfolio</h2>
                <button class="close-btn" onclick="closeImportPortfolioModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="import-info-box">
                    <div class="import-info-title"> CSV Format Requirements</div>
                    <ul class="import-format-list">
                        <li><strong>Header:</strong> <code>EXCHANGE,SYMBOL,NAME,QUANTITY,PRICE,TIMESTAMP</code></li>
                        <li><strong>EXCHANGE:</strong> Must be either <code>NSE</code> or <code>BSE</code></li>
                        <li><strong>SYMBOL:</strong> Stock ticker symbol (e.g., RELIANCE.NS, TCS.BO)</li>
                        <li><strong>NAME:</strong> Company name (use quotes if contains commas)</li>
                        <li><strong>QUANTITY:</strong> Number of shares (positive integer)</li>
                        <li><strong>PRICE:</strong> Purchase price per share (positive decimal)</li>
                        <li><strong>TIMESTAMP:</strong> ISO format (e.g., 2026-02-04T10:30:00)</li>
                    </ul>
                </div>

                <div class="warning-box">
                    <span class="warning-icon"></span>
                    <div>
                        <strong>Important:</strong> The CSV file must have exactly these columns in this order. 
                        Any format mismatch will result in an error. Existing portfolio entries will be updated 
                        (quantities added, prices averaged).
                    </div>
                </div>

                <div class="file-input-wrapper">
                    <label for="portfolioFileInput" class="file-input-label" id="fileInputLabel">
                        <div class="file-icon"></div>
                        <div class="file-input-text" id="fileInputText">
                            Click to select CSV file or drag and drop here
                        </div>
                    </label>
                    <input type="file" 
                           id="portfolioFileInput" 
                           class="file-input" 
                           accept=".csv"
                           onchange="handleFileSelect(this)">
                </div>

                <div style="text-align: center;">
                    <button class="sample-download-btn" onclick="downloadSampleCSV()">
                         Download Sample CSV Template
                    </button>
                </div>

                <div id="importMessage"></div>

                <div class="modal-actions">
                    <button class="btn btn-cancel" onclick="closeImportPortfolioModal()">Cancel</button>
                    <button class="btn btn-confirm" 
                            style="background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);"
                            onclick="importPortfolio()">
                        Import Portfolio
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        function handleFileSelect(input) {
            const label = document.getElementById('fileInputLabel');
            const text = document.getElementById('fileInputText');
            
            if (input.files && input.files.length > 0) {
                const fileName = input.files[0].name;
                text.textContent = `Selected: ${fileName}`;
                text.classList.add('has-file');
                label.classList.add('has-file');
            } else {
                text.textContent = 'Click to select CSV file or drag and drop here';
                text.classList.remove('has-file');
                label.classList.remove('has-file');
            }
        }
    </script>

    <!-- Import Portfolio Modal -->
    <div id="importPortfolioModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title"> Import Portfolio</h2>
                <button class="close-btn" onclick="closeImportPortfolioModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="import-info-box">
                    <div class="import-info-title"> CSV Format Requirements</div>
                    <ul class="import-format-list">
                        <li><strong>Header:</strong> <code>EXCHANGE,SYMBOL,NAME,QUANTITY,PRICE,TIMESTAMP</code></li>
                        <li><strong>EXCHANGE:</strong> Must be either <code>NSE</code> or <code>BSE</code></li>
                        <li><strong>SYMBOL:</strong> Stock ticker symbol (e.g., RELIANCE.NS, TCS.BO)</li>
                        <li><strong>NAME:</strong> Company name (use quotes if contains commas)</li>
                        <li><strong>QUANTITY:</strong> Number of shares (positive integer)</li>
                        <li><strong>PRICE:</strong> Purchase price per share (positive decimal)</li>
                        <li><strong>TIMESTAMP:</strong> ISO format (e.g., 2026-02-04T10:30:00)</li>
                    </ul>
                </div>

                <div class="warning-box">
                    <span class="warning-icon"></span>
                    <div>
                        <strong>Important:</strong> The CSV file must have exactly these columns in this order. 
                        Any format mismatch will result in an error. Existing portfolio entries will be updated 
                        (quantities added, prices averaged).
                    </div>
                </div>

                <div class="file-input-wrapper">
                    <label for="portfolioFileInput" class="file-input-label" id="fileInputLabel">
                        <div class="file-icon"></div>
                        <div class="file-input-text" id="fileInputText">
                            Click to select CSV file or drag and drop here
                        </div>
                    </label>
                    <input type="file" 
                           id="portfolioFileInput" 
                           class="file-input" 
                           accept=".csv"
                           onchange="handleFileSelect(this)">
                </div>

                <div style="text-align: center;">
                    <button class="sample-download-btn" onclick="downloadSampleCSV()">
                         Download Sample CSV Template
                    </button>
                </div>

                <div id="importMessage"></div>

                <div class="modal-actions">
                    <button class="btn btn-cancel" onclick="closeImportPortfolioModal()">Cancel</button>
                    <button class="btn btn-confirm" 
                            style="background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);"
                            onclick="importPortfolio()">
                        Import Portfolio
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        function handleFileSelect(input) {
            const label = document.getElementById('fileInputLabel');
            const text = document.getElementById('fileInputText');
            
            if (input.files && input.files.length > 0) {
                const fileName = input.files[0].name;
                text.textContent = `Selected: ${fileName}`;
                text.classList.add('has-file');
                label.classList.add('has-file');
            } else {
                text.textContent = 'Click to select CSV file or drag and drop here';
                text.classList.remove('has-file');
                label.classList.remove('has-file');
            }
        }
    </script>
</body>
</html>
